<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Socket.io</title>
    <style>
        input {
            padding: 8px;
            margin-top: 8px;
        }

        button {
            padding: 8px;
            margin-top: 8px;
        }
    </style>
</head>

<body>
    <h2>Chat <span id="connect_title"></span></h2>
    <h3>Room: <span id="room_title"></span></h3>
    <h3>Id: <span id="id_title"></span></h3>

    <div>
        <input type="text" id="room_id" value="square">
        <button type="button" onclick="joinRoom()">Join Room</button>
    </div>

    <div>
        <input type="text" id="chat_text" value="Message">
        <button type="button" onclick="send()">Send</button>
    </div>

    <div id="chat_list"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let joinedRoom = null;

        socket.on('connect', function () {
            console.log('[client] connected', Date());
            document.querySelector('#connect_title').innerHTML = 'âœ…';
        });

        // id 
        socket.on('display-id', (idData) => {
            document.querySelector('#id_title').innerHTML = idData.id;
        });

        function joinRoom() {
            // console.log('joinRoom()');

            const roomId = document.querySelector('#room_id').value;
            // console.log('room id: ', roomId);

            if (!roomId) alert('error');

            socket.emit('join', roomId, () => {
                // console.log('join fn()');

                joinedRoom = roomId;
                document.querySelector('#room_title').innerHTML = joinedRoom;
            })
        }

        function send() {
            const chatText = document.querySelector('#chat_text').value;
            console.log(chatText);

            socket.emit('message', { msg: chatText }, (result) => {
                console.log('[client] SendAll Callback result: ', result);

                const chatList = document.querySelector('#chat_list')
                const div = document.createElement('div');
                div.innerHTML = chatText;

                chatList.appendChild(div);
            });
        }
    </script>
</body>

</html>